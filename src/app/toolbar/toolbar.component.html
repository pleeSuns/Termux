<div *ngIf="{ selectionInfo: selectionInfoObservable | async, morphStatus: morphStatusObservable | async } as observableData"
  class="toolbar action-mode-disabled" fxLayout="row" fxLayoutAlign="center center"
  [class.action-mode-enabled]="hasActionModeBeenEnabled && observableData.selectionInfo.getNumSelections() > 0"
  [class.action-mode-disabled]="hasActionModeBeenEnabled && observableData.selectionInfo.getNumSelections() === 0">

  <ng-container *ngIf="{
      numSelections: observableData.selectionInfo.getNumSelections(),
      numSubPaths: observableData.selectionInfo.getNumSubPaths(),
      numSegments: observableData.selectionInfo.getNumSegments(),
      numPoints: observableData.selectionInfo.getNumPoints(),
      isMorphStatusNone: observableData.morphStatus === MORPH_NONE,
      isMorphStatusMorphable: observableData.morphStatus === MORPH_MORPHABLE,
      toolbarTitle: observableData.selectionInfo.getToolbarTitle(),
      showPairSubPaths: observableData.selectionInfo.getNumSubPaths() === 1,
      showReverseSubPaths: observableData.selectionInfo.getNumSubPaths() > 0,
      showDeleteSubPaths: observableData.selectionInfo.getNumSplitSubPaths() > 0,
      showDeleteSegments: observableData.selectionInfo.getNumSegments() > 0,
      showShiftToFirstPosition: observableData.selectionInfo.shouldShowShiftToFirstPosition(),
      showDeletePoints: observableData.selectionInfo.getNumSplitPoints() > 0
    } as data">

    <!-- Shape Shifter logo. -->
    <md-icon *ngIf="data.numSelections === 0" class="toolbar-logo"
      svgIcon="shapeshifter"></md-icon>

    <!-- Action mode close button. -->
    <button md-icon-button *ngIf="data.numSelections > 0" class="action-mode-close-icon"
      (click)="onCloseActionModeClick()">
      <md-icon>close</md-icon>
    </button>

    <!-- Toolbar text. -->
    <span>{{data.toolbarTitle}}</span>

    <span fxFlex="1 1 auto"></span>

    <!-- Default mode buttons. -->
    <button md-icon-button class="toolbar-action-button" [disabled]="!(isDirtyObservable | async)"
      *ngIf="data.numSelections === 0" mdTooltip="New" mdTooltipPosition="below"
      mdTooltipShowDelay="300" (click)="onNewClick()">
      <md-icon>create</md-icon>
    </button>
    <button md-icon-button class="toolbar-action-button" [disabled]="isMorphStatusNone"
      (click)="onAutoFixClick()" mdTooltip="Auto fix" mdTooltipShowDelay="300"
      *ngIf="data.numSelections === 0" mdTooltipPosition="below">
      <md-icon svgIcon="autofix"></md-icon>
    </button>
    <button md-icon-button class="toolbar-action-button" [disabled]="!isMorphStatusMorphable"
      mdTooltip="Export" mdTooltipPosition="below" mdTooltipShowDelay="300"
      *ngIf="data.numSelections === 0" (click)="onExportClick()">
      <md-icon>file_download</md-icon>
    </button>

    <!-- SubPath mode. -->
    <button md-icon-button class="toolbar-action-button" mdTooltip="Morph subpaths"
      mdTooltipPosition="below" *ngIf="data.showPairSubPaths" mdTooltipShowDelay="300"
      (click)="onPairWithSubPathsClick()">
      <md-icon>compare_arrows</md-icon>
    </button>
    <button md-icon-button class="toolbar-action-button" mdTooltip="Reverse points"
      mdTooltipPosition="below" *ngIf="data.showReverseSubPaths"
      mdTooltipShowDelay="300" (click)="onReversePointsClick()">
      <md-icon svgIcon="reverse"></md-icon>
    </button>
    <!-- TODO: determine how we want to support deleting subpaths here -->
    <button md-icon-button class="toolbar-action-button" mdTooltipPosition="below"
      mdTooltip="Delete subpath{{data.numSubPaths === 1 ? '' : 's'}}"
      mdTooltipShowDelay="300" *ngIf="data.showDeleteSubPaths && false"
      (click)="onDeleteSubPathsClick()">
      <md-icon>delete</md-icon>
    </button>

    <!-- Segment mode. -->
    <button md-icon-button class="toolbar-action-button" mdTooltipPosition="below"
      mdTooltip="Delete segment{{data.numSegments === 1 ? '' : 's'}}"
      mdTooltipShowDelay="300" *ngIf="data.showDeleteSegments"
      (click)="onDeleteSegmentsClick()">
      <md-icon>delete</md-icon>
    </button>

    <!-- Point mode. -->
    <button md-icon-button class="toolbar-action-button" mdTooltip="Set first position"
      mdTooltipPosition="below" mdTooltipShowDelay="300" *ngIf="data.showShiftToFirstPosition"
      (click)="onShiftPointToFirstPositionClick()">
      <md-icon>looks_one</md-icon>
    </button>
    <button md-icon-button class="toolbar-action-button" mdTooltipPosition="below"
      mdTooltip="Delete point{{data.numPoints === 1 ? '' : 's'}}"
      mdTooltipShowDelay="300" *ngIf="data.showDeletePoints" (click)="onDeletePointsClick()">
      <md-icon>delete</md-icon>
    </button>

    <!-- Overflow menu buttons. -->
    <button class="toolbar-action-button" md-icon-button [mdMenuTriggerFor]="overflowMenu">
      <md-icon>more_vert</md-icon>
    </button>
    <md-menu #overflowMenu="mdMenu">
      <button md-menu-item (click)="onDemoClick()">
        <md-icon class="material-icons" svgIcon="demoicon"></md-icon>
        <span>Demos</span>
      </button>
      <a href="https://github.com/alexjlockwood/ShapeShifter/issues"
        target="_blank" class="toolbar-overflow-link-item">
        <button md-menu-item (click)="onSendFeedbackClick()">
          <md-icon>bug_report</md-icon>
          <span>Send feedback</span>
        </button>
      </a>
      <a href="https://github.com/alexjlockwood/ShapeShifter/blob/master/README.md"
        target="_blank" class="toolbar-overflow-link-item">
        <button md-menu-item (click)="onAboutClick()">
          <md-icon>info</md-icon>
          <span>About</span>
        </button>
      </a>
    </md-menu>
  </ng-container>
</div>
