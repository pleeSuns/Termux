<div class="studio-layer-timeline"
  *ngIf="(this.layerTimelineModel | async) as model">
  <app-splitter edge="top"
    min="200"
    persist-id="layer-timeline">
  </app-splitter>

  <div class="slt-layers"
    fxLayout="column">
    <app-splitter edge="right"
      min="200"
      persist-id="layer-list">
    </app-splitter>

    <div class="slt-header"
      fxLayout="row"
      fxLayoutAlign="start center">
      <!-- TODO: add file/import/export buttons -->
    </div>

    <div appScrollGroup="timeline"
      class="slt-layers-list-scroller"
      fxFlex>
      <!-- Layer list. -->
      <div class="slt-layers-list">
        <!-- TODO: only display one vector layer? -->
        <app-layerlisttree fxLayout="column"
          class="slt-layer-container"
          *ngFor="let vl of model.vectorLayers; trackBy: this.trackLayerFn;"
          [layer]="vl"
          [animations]="model.animations"
          (onLayerClick)="this.layerClick($event.event, $event.layer)"
          (onLayerDoubleClick)="this.layerDoubleClick($event.event, $event.layer)"
          (onLayerMouseDown)="this.layerMouseDown($event.event, $event.layer)"
          (onAddTimelineBlockClick)="this.addTimelineBlockClick($event.event, $event.layer, $event.propertyName)">
        </app-layerlisttree>
      </div>
      <div *ngIf="(this.dragIndicatorSource.asObservable() | async) as dragData"
        class="slt-layers-list-drag-indicator"
        [ngStyle]="{
            'display': dragData.isVisible ? 'block' : 'none',
            'left': dragData.left + 'px',
            'top': dragData.top + 'px'
          }">
      </div>
      <!-- Layer list empty view. -->
      <div *ngIf="model.vectorLayers.length === 0"
        class="slt-layers-empty">
        <span>Import 2 SVGs to get started<br>(or load a demo in the top right menu)</span>
      </div>
    </div>
  </div>

  <!-- Animation timeline. -->
  <div class="slt-timeline">
    <ng-container *ngFor="let animation of model.animations; trackBy: trackAnimationFn;">
      <div class="slt-timeline-animation"
        (mousedown)="this.animationTimelineMouseDown($event, animation)"
        [ngClass]="{'is-active': model.activeAnimation === animation}"
        [ngStyle]="{'width': (animation.duration * this.horizZoom + 40) + 'px'}"
        fxLayout="column">

        <div class="slt-header">
          <!-- TODO: add selected_ attribute to animation? -->
          <div class="slt-timeline-animation-meta"
            [ngClass]="{'is-selected': animation.selected_}"
            (click)="this.animationHeaderTextClick($event, animation)">
            <span class="slt-timeline-animation-name">{{animation.id}}</span>
            <span class="slt-timeline-animation-duration">{{animation.duration}}ms</span>
          </div>
          <canvas appLayerTimeline
            class="slt-timeline-header-grid"
            [isActive]="model.activeAnimation === animation"
            [animation]="animation"
            [activeTime]="this.activeTime"
            [horizZoom]="this.horizZoom"
            [isHeader]="true"
            (onScrub)="this.timelineHeaderScrub($event)"></canvas>
        </div>

        <canvas appLayerTimeline
          class="slt-timeline-grid"
          [animation]="animation"
          [isActive]="model.activeAnimation === animation"
          [activeTime]="this.activeTime"
          [horizZoom]="this.horizZoom"></canvas>

        <div appScrollGroup="timeline"
          class="slt-timeline-animation-scroller">
          <div class="slt-timeline-animation-rows">
            <!-- TODO: only display one vector layer? -->
            <app-timelineanimationrow *ngFor="let layer of model.vectorLayers; trackBy: this.trackLayerFn;"
              [layer]="layer"
              [animation]="animation"
              [animations]="model.animations"
              (onTimelineBlockMouseDown)="this.timelineBlockMouseDown($event.event, $event.block, $event.animation, $event.layer)"
              (onTimelineBlockClick)="this.timelineBlockClick($event.event, $event.block, $event.animation, $event.layer)">
            </app-timelineanimationrow>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- TODO: do we want to show this? -->
  <!--<div layout="row" layout-align="start stretch">
    <div class="slt-timeline-animation-new-container" layout="column"
      layout-align="center center">
      <md-button ng-click="ctrl.onAddNewAnimation()" class="slt-timeline-animation-new"
        layout="column" layout-align="center center">
        <md-icon md-svg-icon="avdstudio:add_animation"></md-icon>
        <span>New animation</span>
      </md-button>
    </div>
  </div>
</div>-->
